<!DOCTYPE html>
<html lang="en">


<link href="jquery.flowchart.css" rel="stylesheet" type="text/css">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <script src="https://code.jquery.com/jquery-3.3.1.js"
            integrity="sha256-2Kok7MbOyxpgUVvAk/HJ2jigOSYS2auK4Pfzbm7uH60="
            crossorigin="anonymous"></script>
    <script src="static/jquery-ui/jquery-ui.js"></script>
    <script src="static/js/jquery.flowchart.js"></script>

    <link rel="stylesheet" type="text/css" href="static/jquery-ui/jquery-ui.css">
    <link rel="stylesheet" type="text/css" href="static/jquery-ui/jquery-ui.structure.css">
    <link rel="stylesheet" type="text/css" href="static/jquery-ui/jquery-ui.theme.css">
    <link rel="stylesheet" href="static/css/jquery.flowchart.css">
</head>
<body>
    <div style="width:1000px; height:500px;" id="example"></div>
    <button style="width:100px; height:50px;" class="add_node">노드 추가</button>

    <div class="operator_contents_edit">
        <label>Operator's content: </label>
        <textarea type="text"></textarea>
        <button>변경</button>
    </div>
</body>
<script>
$(document).ready(function() {
    var data = {
      "operators": {
        "created_operator_1": {
          "top": 120,
          "left": 100,
          "properties": {
            "title": "Operator 1",
            "contents": "example content1",
            "inputs": {
              "input_1": {
                "label": "In",
                "multiple": true
              }
            },
            "outputs": {
              "output_1": {
                "label": "Out",
                "multiple": true
              }
            }
          }
        },
        "created_operator_2": {
          "top": 280,
          "left": 480,
          "properties": {
            "title": "Operator 2",
            "contents": "example content2",
            "inputs": {
              "input_1": {
                "label": "In",
                "multiple": true
              }
            },
            "outputs": {
              "output_1": {
                "label": "Out",
                "multiple": true
              }
            }
          }
        }
      },
      "links": {
        "0": {
          "fromOperator": "created_operator_1",
          "fromConnector": "output_1",
          "fromSubConnector": 0,
          "toOperator": "created_operator_2",
          "toConnector": "input_1",
          "toSubConnector": 0
        }
      },
      "operatorTypes": {}
    }
    // Apply the plugin on a standard, empty div...
    // $('#example').flowchart({
    //   data: data
    // });
    $('#example').flowchart({
        data: data,
        onOperatorSelect: function(operatorId) {
            $('.operator_contents_edit').show();
            $('.operator_contents_edit textarea').val(
                $flowchart.flowchart('getOperatorContents', operatorId));
            console.log($flowchart.flowchart('getOperatorContents', operatorId));
            return true;
        },
    });
});

var $flowchart = $('#example');

// Id matters!
var operatorI = 3;

$(".add_node").click(function() {
  var operatorId = 'created_operator_' + operatorI;
  var operatorData = {
    top: 200,
    left: 200,
    properties: {
      title: 'Operator ' + (operatorI),
      contents: "example contents",
      inputs: {
        input_1: {
          label: 'In',
          multiple: true,
        }
      },
      outputs: {
        output_1: {
          label: 'Out',
          multiple: true,
        }
      }
    }
  };

  operatorI++;

  $('#example').flowchart('createOperator', operatorId, operatorData);
});

</script>
</html>
